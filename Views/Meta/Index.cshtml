@model mu_marketplaceV0.ViewModels.MetaViewModel
@{
    ViewData["Title"] = "Metadata Test";
    Layout = "_Layout";
}

<h2 class="mb-4">Metadata JSON Preview for: @Model.Song.Title</h2>

<div class="card bg-dark text-light mb-4">
    <div class="card-body">
        <pre>@Html.Raw(Model.Json)</pre>
    </div>
</div>

<form method="get" class="d-flex align-items-center text-light mb-4">
    <label for="id" class="me-2">Load Another Song by ID:</label>
    <input type="number"
           name="id"
           id="id"
           value="@Model.Song.Id"
           class="form-control me-2"
           style="width:80px; background: #1f1f1f; border: 1px solid #444; color: #e0e0e0;" />
    <button type="submit" class="btn btn-primary">Load</button>
</form>

<form asp-controller="Mint" asp-action="Index" method="post" class="mb-3">
    <input type="hidden" name="id" value="@Model.Song.Id" />
    <button type="submit" class="btn btn-warning">🚀 Mint on Solana</button>
</form>

<div id="mintResult" class="mt-3 text-light"></div>

@section Scripts {
    <script>
        // Convert mint form to AJAX submit
        const mintForm = document.querySelector('form[asp-controller="Mint"]');
        mintForm.addEventListener('submit', async function(e) {
          e.preventDefault();
          const resultEl = document.getElementById('mintResult');
          resultEl.textContent = 'Minting...';
          const response = await fetch(mintForm.action, {
            method: 'POST',
            body: new FormData(mintForm)
          });
          if (!response.ok) {
            const errorText = await response.text();
            resultEl.textContent = 'Error: ' + errorText;
            return;
          }
          const data = await response.json();
          resultEl.textContent = 'Result: ' + JSON.stringify(data);
        });
    </script>
}
